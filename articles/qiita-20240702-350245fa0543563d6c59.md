---
title: "[ReactNative] WebViewã¨ã‚¢ãƒ—ãƒªã§ãƒ‡ãƒ¼ã‚¿ã‚’ã‚„ã‚Šã¨ã‚Šã™ã‚‹"
emoji: "ğŸ˜€"
type: "tech"
topics: [Android,iOS,React,reactnative]
published: false
---
## å‰æ
- [react-native-webview](https://github.com/react-native-webview/react-native-webview/blob/master/docs/Reference.md)ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨
- `react-native`ï¼š `0.72.10`

## WebViewã§è¡¨ç¤ºã—ã¦ã„ã‚‹ç”»é¢ã®æ“ä½œã‚’ã‚¢ãƒ—ãƒªã§ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ãŸã„
ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã—ã¦ã„ã‚‹ã¨ã€ã©ã†ã—ã¦ã‚‚WebViewã‚’ä½¿ç”¨ã›ã–ã‚‹ã‚’å¾—ãªã„ã“ã¨ã£ã¦å¤šããªã„ã§ã—ã‚‡ã†ã‹ï¼Ÿä¾‹ãˆã°ã€ECã®ã‚¢ãƒ—ãƒªã§æ±ºæ¸ˆå‘¨ã‚Šã®éƒ¨åˆ†ãŒAPIé–‹ç™ºã™ã‚‹ã¨è‰²ã€…é¢å€’ãªã®ã§ã€WebViewã§ãã®ã¾ã¾è¡¨ç¤ºã•ã›ã‚‹ã¨ã‹ã€ã‚¹ã‚¯ãƒ©ãƒƒãƒã§ä½œã‚‹ã¨å·¥æ•°ãŒã‹ã‹ã‚‹ã‹ã‚‰ä¸€éƒ¨åˆ†ã¯WebViewã«ã™ã‚‹...ãªã©ãªã©ã€‚
ãã‚“ãªæ™‚ã«ã€ã€ŒWebViewå†…ã§ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚­ãƒ£ãƒƒãƒã—ã¦ã‚¢ãƒ—ãƒªå´ã§ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ãŸã„ã€ãªã‚“ã¦ã“ã¨ãŒã—ã°ã—ã°ã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«å‡ºã™ã¨ã‹ã€ã‚¢ãƒ—ãƒªã®ç”»é¢ã«é·ç§»ã•ã›ã‚‹ã¨ã‹ï¼‰
ä»Šå›ã¯ãã‚“ãªæ™‚ã«ã€ã©ã®ã‚ˆã†ã«ã—ã¦ã‚„ã‚Šã¨ã‚Šã‚’è¡Œã†ã‹èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚

## æµã‚Œ
1. [react-native-webview](https://github.com/react-native-webview/react-native-webview/blob/master/docs/Reference.md) ã®`<WebView />`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®[injectedJavaScript](https://github.com/react-native-webview/react-native-webview/blob/master/docs/Reference.md#injectedjavascript) propsã§WebViewå†…ã§å®Ÿè¡Œã—ãŸã„JavaScriptã‚’è¨˜è¿°ã€‚
1. ãã®JavaScriptã®ä¸­ã§`window.ReactNativeWebView.postMessage()`ã™ã‚‹ã€‚
1. ã‚¢ãƒ—ãƒªå´ã§ã¯`onMessage={}` propsã§WebViewå†…ã‹ã‚‰ã®postMessageã‚’å—ã‘å–ã‚‹ã€‚
1. onMessageã§ã‚¢ãƒ—ãƒªã§ã‚„ã‚ŠãŸã„å‡¦ç†ã‚’è¨˜è¿°

## å®Ÿè£…
å®Œæˆç³»ã¯ä»¥ä¸‹ã§ã™ã€‚

```SampleScreen.tsx
import React from 'react';
import { StyleSheet, View } from 'react-native';
import WebView, { WebViewMessageEvent } from 'react-native-webview';

export const SampleScreen = () => {
  const injectedJavaScript = `
    window.ReactNativeWebView.postMessage(
      JSON.stringify({
        type: 'postTest',
      })
    );
  `;

  const _onMessage = async (event: WebViewMessageEvent) => {
    const data = JSON.parse(event.nativeEvent.data);
    switch (data.type) {
      case 'postTest':
        console.log('å—ã‘å–ã‚Šã¾ã—ãŸã€‚');
        break;
      default:
        break;
    }
  };

  return (
    <View style={styles.container}>
      <WebView
        style={styles.container}
        containerStyle={styles.container}
        source={{ uri: 'https://example.com/' }}
        injectedJavaScript={injectedJavaScript}
        onMessage={_onMessage}
      />
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
  },
});

```

### è§£èª¬
WebViewã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®`injectedJavaScript` propsã«ã¯WebViewå†…ã§å®Ÿè¡Œã—ãŸã„JavaScriptã‚’æ¸¡ã—ã¦ã‚ã’ã¾ã™ã€‚ä»Šå›ã¯`window.ReactNativeWebView.postMessage()`ã¨ã—ã¦`type`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«`postTest`ã¨ã„ã†æ–‡å­—åˆ—ã‚’æ¸¡ã—ã¦ã‚ã’ã¾ã™ã€‚
```injectedJavaScript.js
const injectedJavaScript = `
    window.ReactNativeWebView.postMessage(
      JSON.stringify({
        type: 'postTest',
      })
    );
  `;
```
ã“ã®injectedJavaScriptã¯WebViewã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒèª­ã¿è¾¼ã¾ã‚ŒãŸæ™‚ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã‚‚ã—ã€å®Ÿè¡Œã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ãšã‚‰ã—ãŸã„ã®ã§ã‚ã‚Œã°ã€`domcontentloaded`ã‚„`mutationObserver`ã€`setTimeout`ã€ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãªã‚‰`.addEventListener('click', function(event) {});`ãªã©ã‚’ä½¿ã†ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚

ãã—ã¦ã€ã“ã®postMessageã‚’ã‚¢ãƒ—ãƒªå´ã§å—ã‘å–ã‚‹ãŸã‚ã«`onMessage={_onMessage}`ã¨ã—ã¦ã€å®šç¾©ã—ã¦ã„ã¾ã™ã€‚
```onMessage.js
const _onMessage = async (event: WebViewMessageEvent) => {
    const data = JSON.parse(event.nativeEvent.data);
    switch (data.type) {
      case 'postTest':
        console.log('å—ã‘å–ã‚Šã¾ã—ãŸã€‚');
        break;
      default:
        break;
    }
  };
```

å¼•æ•°ã«eventã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¦ã€`event.nativeEvent.data`ã§postMessageã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»Šå›ã¯`type: 'postTest',`ãªã®ã§ã€`event.nativeEvent.data.type`ã§'postTest'ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»–ã«ã‚‚

```injectedJavaScript.js
const injectedJavaScript = `
    window.ReactNativeWebView.postMessage(
      JSON.stringify({
        type: 'postTest',
        id: 1
      })
    );
  `;
```
ã¨ã™ã‚Œã°`event.nativeEvent.data.id`ã¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»Šå›ã®ã‚ˆã†ã«switch-caseå¥ã§è¨˜è¿°ã™ã‚‹ã¨ã€ä»–ã«ã‚‚injectedScriptã§postMessageã—ãŸå ´åˆã«ã‚‚ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

æœ€å¾Œã«`case 'postTest'`ã®ä¸­ã§å®Ÿè¡Œã—ãŸã„å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ã€‚ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ãŸã‚Šã€stateã‚’æ›´æ–°ã—ãŸã‚Šã§ãã¾ã™ã€‚

## ã¾ã¨ã‚
ã„ã‹ãŒã ã£ãŸã§ã—ã‚‡ã†ã‹ã€‚å€‹äººçš„ã«ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã§DOMæ“ä½œã—ã¦ã„ã‚‹ã“ã¨ã«ãªã‚‹ã®ã§ã€ãƒ­ãƒ¼ãƒ‰æ™‚ã«å®Ÿè¡Œã—ãŸã„JavaScriptãŒã‚ã‚‹å ´åˆã¯ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’æŒŸã‚“ã æ–¹ãŒã„ã„ã‹ãªã¨æ€ã„ã¾ã—ãŸã€‚ã‚ã¨ã€injectScriptå†…ã§å‡¦ç†ãŒå¤±æ•—ã™ã‚‹ã¨ã€å¾Œç¶šã®å‡¦ç†ã¯ã‚‚ã¡ã‚ã‚“å®Ÿè¡Œã•ã‚Œãªããªã‚‹ã®ã§ã€æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚

## å‚è€ƒ

https://github.com/react-native-webview/react-native-webview/blob/master/docs/Reference.md

https://zenn.dev/erukiti/articles/react-native-webview-comm


