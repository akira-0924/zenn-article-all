---
title: "[AWS] CDKã®aws-s3-deploymentã§S3ã®ç‰¹å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ›´æ–°ã™ã‚‹éš›ã®æ³¨æ„ç‚¹"
emoji: "ğŸ˜€"
type: "tech"
topics: [AWS,S3,CDK]
published: false
---
## ã‚„ã‚ŠãŸã„ã“ã¨

CDKã§S3ãƒã‚±ãƒƒãƒˆã«ã‚ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ›´æ–°ã—ãŸã„ï¼
ä»Šå›ã¯CDKã®`aws-s3-deployment`ã‚’ä½¿ã£ã¦S3ã«ã‚ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ›´æ–°ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3_deployment-readme.html


å…¬å¼ã®æ–‡é ­ã®èª¬æ˜ã¯ä»¥ä¸‹ã€‚
>This library allows populating an S3 bucket with the contents of .zip files from other S3 buckets or from local disk.
The following example defines a publicly accessible S3 bucket with web hosting enabled and populates it from a local directory on disk.

`aws-s3-deployment`ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã®zipãƒ•ã‚¡ã‚¤ãƒ«ã‚’S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å ´åˆã«ä½¿ãˆã‚‹ã‚ˆã¨ã®ã“ã¨ã€‚

ä»•çµ„ã¿ã¯ä»¥ä¸‹ã€‚
>When this stack is deployed (either via cdk deploy or via CI/CD), the contents of the local website-dist directory will be archived and uploaded to an intermediary assets bucket (the StagingBucket of the CDK bootstrap stack). If there is more than one source, they will be individually uploaded.
The BucketDeployment construct synthesizes a Lambda-backed custom CloudFormation resource of type Custom::CDKBucketDeployment into the template. The source bucket/key is set to point to the assets bucket.
The custom resource invokes its associated Lambda function, which downloads the .zip archive, extracts it and issues aws s3 sync --delete against the destination bucket (in this case websiteBucket). If there is more than one source, the sources will be downloaded and merged pre-deployment at this step.


å†…éƒ¨çš„ã« AWS Lambda é–¢æ•°ã‚’ä½œã£ã¦ã€Lambda é–¢æ•°ã®ä¸­ã‹ã‚‰ AWS CLI ã®Â `aws s3 sync`Â ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ Amazon S3 ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã‚‹ã‚‰ã—ã„ã€‚
CloudFormationã‚’è¦‹ã‚‹ã¨ã‚ã‹ã‚‹ã®ã§ã“ã“ã‚‰è¾ºã¯ã€å®Ÿéš›ã«ã‚„ã£ã¦ã¿ã¦ç¢ºã‹ã‚ã‚‹ãŒã€`Custom::CDKBucketDeployment`Â ã®ä¸­ã« AWS Lambda é–¢æ•°ãŒå«ã¾ã‚Œã¦ã„ãŸã®ã¯ã“ã†ã„ã†ã“ã¨ã ã£ãŸã€‚

[å…¬å¼](https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3_deployment-readme.html)

## ä½•ã¯ã¨ã‚‚ã‚ã‚Œä½¿ã£ã¦ã¿ã‚‹

å…¬å¼ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’ã‚‚ã¨ã«ã‚ã¡ã‚ƒãã¡ã‚ƒã‚·ãƒ³ãƒ—ãƒ«ã«æ›¸ã„ã¦ã¿ã‚‹ã€‚
å‰ææ¡ä»¶ã¨ã—ã¦ã¯
- TypeScript
- æ—¢ã«S3ã«`cdk-deployemnt-test-xxxx`ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆæ¸ˆã¿ã€‚
- cdk ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«`/assets/example.json.zip`ãŒã‚ã‚‹ã€‚ï¼ˆexample.jsonã‚’åœ§ç¸®ï¼‰
```example.json
{
  "example": "testExample001"
}

```
```upload-stack.ts
import { Stack, StackProps } from "aws-cdk-lib";
import { Construct } from "constructs";
import { Bucket } from "aws-cdk-lib/aws-s3";
import * as s3deployment from "aws-cdk-lib/aws-s3-deployment";

export class UploadStack extends Stack {
  constructor(scope: Construct, id: string, props?: StackProps) {
    super(scope, id, props);

    // æ—¢ã«S3ã«ã‚ã‚‹ãƒã‚±ãƒƒãƒˆã‚’å–å¾—
    const existing_bucket = Bucket.fromBucketArn(
      this,
      "cdk-deployemnt-test-xxxx",
      "arn:aws:s3:::cdk-deployemnt-test-xxxx"
    );

    new s3deployment.BucketDeployment(this, "BucketDeploymentExample001", {
      // ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚ã‚‹ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸã„ã‚½ãƒ¼ã‚¹ã‚’æŒ‡å®šã€‚
      sources: [s3deployment.Source.asset("./assets/admin.json.zip")],
      // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å…ˆã®ãƒã‚±ãƒƒãƒˆã‚’æŒ‡å®š
      destinationBucket: existing_bucket,
      //  ã©ã®ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸã„ã‹ã‚’æŒ‡å®š(ä»Šå›ã¯/example/test001/example.jsonã‚’ä½œã‚‹)
      destinationKeyPrefix: "example/test001/",
    });
  }
}

```
`cdk deploy UploadStack`ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
ãƒ‡ãƒ—ãƒ­ã‚¤ã«æˆåŠŸã™ã‚‹ã¨ã€ç„¡äº‹ã€
`ãƒã‚±ãƒƒãƒˆ/example/test001/example.json`ãŒä½œæˆã•ã‚ŒãŸã€‚
![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2024-06-02 17.23.51.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3655825/c775db16-1e56-3308-1e3b-2f594d4aa994.png)

### ä¸­èº«ã‚’å¤‰ãˆã¦ã¿ã‚‹
`example.json`ã®ä¸­èº«ã‚’`testExample002`ã«å¤‰ãˆã¦ã¿ã‚‹ã€‚
```example.json
{
  "example": "testExample002"
}

```
æ—¢å­˜ã®`example.json.zip`ã‚’ä¸€å›å‰Šé™¤ã—ã€æ–°ãŸã«å¤‰æ›´ã—ãŸ`example.json`ã‹ã‚‰zipãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã€‚ãã®å¾Œã€`cdk deploy`ã™ã‚‹ã€‚

ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã¦ã€ä¸­èº«ã‚’ç¢ºèªã™ã‚‹ã¨...
ç¢ºã‹ã«`testExample002`ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ããŸã€‚

### ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¦ã¿ã‚‹
`BucketDeployment`ãƒªã‚½ãƒ¼ã‚¹è‡ªä½“ã‚’å‰Šé™¤ã™ã‚‹ã¨ã©ã†ãªã‚‹ã ã‚ã†ã‹ã€‚example.jsonã¯æ¶ˆãˆã‚‹ã®ã‹ã€æ®‹ã‚‹ã®ã‹ã€‚ä½•ã‚‚è€ƒãˆãšã€ã¾ãšã‚„ã£ã¦ã¿ã‚‹ã€‚
``` upload-stack.ts
import { Stack, StackProps } from "aws-cdk-lib";
import { Construct } from "constructs";
import { Bucket } from "aws-cdk-lib/aws-s3";
import * as s3deployment from "aws-cdk-lib/aws-s3-deployment";

export class UploadStack extends Stack {
  constructor(scope: Construct, id: string, props?: StackProps) {
    super(scope, id, props);

    //ä¸€æ—¦å…¨ã¦ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
    // const existing_bucket = Bucket.fromBucketArn(
    //   this,
    //   "cdk-deployemnt-test-xxxxxx",
    //   "arn:aws:s3:::cli-deployemnt-test-xxxxxx"
    // );

    // new s3deployment.BucketDeployment(this, "BucketDeploymentExample001", {
    //   sources: [s3deployment.Source.asset("./assets/example.json.zip")],
    //   destinationBucket: existing_bucket,
    //   destinationKeyPrefix: "example/test001/",
    // });
  }
}

```
â†‘ã®çŠ¶æ…‹ã§åŒæ§˜ã«`cdk deploy`ã—ã¦ã¿ã‚‹ã€‚
ã™ã‚‹ã¨...
**example.jsonã‚„ä½œæˆã—ãŸãƒ•ã‚©ãƒ«ãƒ€ã¯æ®‹ã£ãŸã¾ã¾ã«ãªã‚‹ã€‚**
ã“ã‚Œã¯å…¬å¼ã«ã‚‚è¨˜è¼‰ãŒã‚ã£ãŸã€‚
https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3_deployment-readme.html#retain-on-delete

>By default, the contents of the destination bucket will not be deleted when the BucketDeployment resource is removed from the stack or when the destination is changed. 

S3ãƒã‚±ãƒƒãƒˆã®ä½œæˆã¨åŒã˜ã§1åº¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¦ã‚‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯æ®‹ã£ãŸã¾ã¾ã«ãªã‚‹ã‚‰ã—ã„ã€‚ãªã‚‹ã»ã©ã€ã€
ã‚‚ã†ä¸€ã¤ã€ã“ã®ç†è«–ã§ã„ãã¨ã€ã‚¹ã‚¿ãƒƒã‚¯è‡ªä½“ã‚’å‰Šé™¤ã—ã¦ã‚‚æ®‹ã‚‹ã¨ã„ã†ã“ã¨ã«ãªã‚‹ã®ã§ã€ãƒãƒã‚³ãƒ³ã®CloudFormationã‹ã‚‰ä»Šå›ã®`UploadStack`è‡ªä½“ã‚’å‰Šé™¤ã—ã¦ã¿ã‚‹ã€‚
![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2024-06-02 17.46.21.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3655825/6bee3476-15d1-297a-7ff5-a19a01eaad11.png)
example.jsonã¯æ®‹ã£ãŸã¾ã¾ã€‚ãªã‚‹ã»ã©ã€ã€
ã•ã‚‰ã«ã€å…¬å¼ã«ã¯
>You can use the option retainOnDelete: false to disable this behavior, in which case the contents will be deleted.

ã®è¨˜è¼‰ãŒã‚ã‚Šã€`retainOnDelete:false`ã‚’æŒ‡å®šã™ã‚‹ã¨ã‚¹ã‚¿ãƒƒã‚¯ã®å‰Šé™¤æ™‚ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚‚å‰Šé™¤ã§ãã‚‹ã¨æ›¸ã„ã¦ã‚ã‚‹ã®ã§è©¦ã—ã¦ã¿ã‚‹ã€‚ä¸€åº¦`retainOnDelete:false`ã‚’è¿½åŠ ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã‹ã‚‰ã€
``` upload-stack.ts
new s3deployment.BucketDeployment(this, "BucketDeploymentExample001", {
       sources: [s3deployment.Source.asset("./assets/example.json.zip")],
       destinationBucket: existing_bucket,
       destinationKeyPrefix: "example/test001/",
       // retainOnDeleteã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
       retainOnDelete: false,
});
```

å…ˆã»ã©åŒæ§˜ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦å†åº¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã€‚ã™ã‚‹ã¨ã€ã€
æ¶ˆãˆã‚‹ã€ã€!!ï¼ˆã‚¹ã‚¿ãƒƒã‚¯è‡ªä½“ã‚’å‰Šé™¤ã—ã¦ã‚‚åŒã˜ï¼‰

ãªã‹ãªã‹æã‚ã—ã„ã®ã§ã€å…¬å¼ã«ã¯ä»¥ä¸‹ã®2ç‚¹ã«æ³¨æ„ã™ã‚‹ã“ã¨ã¨è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã€‚
>Logical ID Changes
Changing the logical ID of the BucketDeployment construct, without changing the destination (for example due to refactoring, or intentional ID change) will result in the deletion of the objects. This is because CloudFormation will first create the new resource, which will have no affect, followed by a deletion of the old resource, which will cause a deletion of the objects, since the destination hasn't changed, and retainOnDelete is false.

>Destination Changes
When the destination bucket or prefix is changed, all files in the previous destination will first be deleted and then uploaded to the new destination location. This could have availability implications on your users.

è¦ã¯ è«–ç†IDï¼ˆBucketDeploymentExample001ï¼‰ã‚’å¤‰æ›´ã™ã‚‹ã¨ãã®ãƒªã‚½ãƒ¼ã‚¹ãŒ1å›å‰Šé™¤ã•ã‚Œã¾ã™ã‚ˆã£ã¦ã“ã¨ã£ã½ã„ã€‚1å›å‰Šé™¤ã•ã‚Œã¦ã€æ–°ã—ã„ãƒªã‚½ãƒ¼ã‚¹ãŒä½œæˆã•ã‚Œã‚‹ã‹ã‚‰ã€ã‚ãšã‹ãªãŒã‚‰ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ã¯ç™ºç”Ÿã—ãã†ã€‚ãªã®ã§ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆtrueï¼‰ã®ã¾ã¾ãŒã¨ã‚Šã‚ãˆãšå®‰å…¨ã‹ãªã€‚

## è¤‡æ•°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚‹å ´åˆ

ä»Šåº¦ã¯ã€æ—¢ã«ãƒã‚±ãƒƒãƒˆå†…ã«test002ãƒ•ã‚©ãƒ«ãƒ€ãŒã‚ã‚Šã€ãã“ã«ã‚ã‚‹`example2.json`ã‚’æ›´æ–°ã—ãŸã„å ´åˆã‚’è©¦ã—ã¦ã¿ã‚‹ã€‚
å‰ææ¡ä»¶ã¯ã€
- æ—¢ã«`ãƒã‚±ãƒƒãƒˆ/example/test002`ãƒ•ã‚©ãƒ«ãƒ€ãŒã‚ã‚‹
- ãã“ã«`example.json`ã€`example2.json`ã€ã•ã‚‰ã«`/images/001.png`ãŒå­˜åœ¨ã™ã‚‹
```
â””â”€â”€ cdk-deployemnt-test-xxxxxx/
    â””â”€â”€ example/
        â””â”€â”€ test002/
            â”œâ”€â”€ example.json
            â”œâ”€â”€ example2.json
            â””â”€â”€ images/
                â””â”€â”€ 001.png
```
``` example2.json
{
  "example": "testExample002å¤‰æ›´å‰"
}

```

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2024-06-02 18.14.17.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3655825/82567f52-4704-39d9-6c57-ab2c2a86907b.png)

ã¾ãšã¯ã€ä»Šã¾ã§é€šã‚Šã‚„ã£ã¦ã¿ã‚‹ã€‚
```upload-stack.ts
new s3deployment.BucketDeployment(this, "BucketDeploymentExample002", {
      sources: [s3deployment.Source.asset("./assets/example2.json.zip")],
      destinationBucket: existing_bucket,
      destinationKeyPrefix: "example/test002/",
    });
```

ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã¨ã©ã†ãªã‚‹ã ã‚ã†ã‹ã€ã€
`example.json`ã•ã‚‰ã«ã¯`/images/001.png`ãŒæ¶ˆãˆãŸã€ã€ğŸ˜§ğŸ˜§

ã©ã†ã„ã†ã‚ã‘ã‹ã€å…¬å¼ã‚’èª­ã‚“ã§ã„ã£ã¦ã„ã‚‹ã¨ã€[ã“ã“](https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3_deployment-readme.html#prune)ã«è¨˜è¼‰ã•ã‚Œã¦ã„ãŸã€‚
>By default, files in the destination bucket that don't exist in the source will be deleted when the BucketDeployment resource is created or updated. You can use the option prune: false to disable this behavior, in which case the files will not be deleted.

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€BucketDeployment ãƒªã‚½ãƒ¼ã‚¹ãŒä½œæˆã¾ãŸã¯æ›´æ–°ã•ã‚Œã‚‹ã¨ã€ã‚½ãƒ¼ã‚¹ã«å­˜åœ¨ã—ãªã„ãƒ‡ã‚¹ãƒ†ã‚£ãƒãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚±ãƒƒãƒˆå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯å‰Šé™¤ã•ã‚Œã‚‹ä»•æ§˜ã‚‰ã—ã„ã€‚
ã¤ã¾ã‚Šã€ä»Šå›ã®å ´åˆã€`destinationKeyPrefix: "example/test002/"`ã«å¯¾ã—ã¦ã®å¤‰æ›´ã‚’è¡Œãªã£ãŸãŸã‚ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯**ã“ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®`destinationKeyPrefix`ã§æŒ‡å®šã—ã¦ã„ãªã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯å…¨ã¦å‰Šé™¤ã•ã‚Œã‚‹ã¨ã„ã†ã“ã¨**ã€‚ï¼ˆ001.pngã‚‚æ¶ˆãˆãŸã®ã§ã€ãã‚Œä»¥ä¸‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚‚å…¨ã¦å‰Šé™¤ã•ã‚Œã‚‹ã£ã½ã„ï¼‰

ã“ã‚Œã¯æã‚ã—ã„ã€ã€ã€ï¼ˆã¡ãªã¿ã«ã“ã‚ŒãŒã‚ã‹ã£ã¦ã„ãªãã¦ç­†è€…ã¯æœ¬ç•ªç’°å¢ƒã§S3ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã»ã¨ã‚“ã©é£›ã°ã™ã¨ã„ã†ã‚„ã‚‰ã‹ã—ã‚’ã—ã¾ã—ãŸ...ï¼‰

ã§ã¯ã€ã©ã†ã™ã‚Œã°ã„ã„ã‹ã€‚ç­”ãˆã¯ç°¡å˜ã€`prune: false`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ã ã‘ã€‚
```upload-stack.ts
new s3deployment.BucketDeployment(this, "BucketDeploymentExample002", {
      sources: [s3deployment.Source.asset("./assets/example2.json.zip")],
      destinationBucket: existing_bucket,
      destinationKeyPrefix: "example/test002/",
      // è¿½åŠ 
      prune: false,
    });
```
ã“ã‚Œã ã‘ã€‚example.jsonã¨001.pngã‚’å†åº¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦â†‘ã§`cdk deploy`ã‚’å®Ÿè¡Œã€‚
ã™ã‚‹ã¨...
æ®‹ã£ã¦ã„ã‚‹ã€ã€ãã—ã¦example2.jsonã®ä¸­èº«ã‚‚ã¡ã‚ƒã‚“ã¨æ›´æ–°ã•ã‚Œã¦ã„ã‚‹ï¼
æ—¢å­˜ã®ä¸€éƒ¨ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦ä½•ã‹ã—ã‚‰æ›´æ–°ã—ãŸã„ã¨ãã¯ã“ã‚Œã»ã¼å¿…é ˆã˜ã‚ƒãªã„ã‹ãªã¨ã„ã†æ„Ÿã˜ã€‚

ã¡ãªã¿ã«ã€ç§ãŒéå»ã‚„ã‚‰ã‹ã—ãŸæ¡ˆä»¶ã§ã¯ä»Šå›ã§è¨€ã†ã¨ã€
`/example`ãƒ•ã‚©ãƒ«ãƒ€ã«`app.json`ã¨`admin.json`ãŒã‚ã‚Šã€ã•ã‚‰ã«`/images`ãƒ•ã‚©ãƒ«ãƒ€ãŒã‚ã‚Šã€ãã“ã®å¤§é‡ã®ç”»åƒãŒä¿å­˜ã•ã‚Œã¦ã„ãŸã€‚
ãã“ã§app.jsonã¨admin.jsonã®æ›´æ–°ã‚’ã—ã‚ˆã†ã¨ã—ãŸéš›ã«ã€
```typescript
new s3deployment.BucketDeployment(this, "BucketDeploymentExample001", {
      sources: [s3deployment.Source.asset("./assets/admin.json.zip")],
      destinationBucket: existing_bucket,
      destinationKeyPrefix: "example/",
});

new s3deployment.BucketDeployment(this, "BucketDeploymentExample002", {
      sources: [s3deployment.Source.asset("./assets/app.json.zip")],
      destinationBucket: existing_bucket,
      destinationKeyPrefix: "example/",
});
```
ã®ã‚ˆã†ã«æ›¸ã„ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿè¡Œã—ãŸã€‚ã“ã“ã¾ã§èª­ã‚“ã æ–¹ã¯ã‚‚ã†ã‚ã‹ã£ãŸã¨æ€ã†ãŒã€â†‘ã®å ´åˆã€ã¾ãš`BucketDeploymentExample001`ã§admin.jsonã‚’æ›´æ–°ã—ã¦ã„ã‚‹ãŒã€ãã‚Œä»¥å¤–ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å…¨éƒ¨å‰Šé™¤...ã€‚ã•ã‚‰ã«ã¯ãã®å¾Œã«`BucketDeploymentExample002`ã«ã‚ˆã£ã¦admin.jsonã‚‚å‰Šé™¤ã•ã‚Œãƒã‚±ãƒƒãƒˆã«æ®‹ã£ãŸã®ã¯`app.json`ã®ã¿...ã€‚æ‚²æƒ¨ã§ã‚ã‚‹ã€‚
ã“ã®å ´åˆã¯ã€
```typescript
new s3deployment.BucketDeployment(this, "BucketDeploymentExample001", {
      sources: [
        s3deployment.Source.asset("./assets/app.json.zip"), 
        s3deployment.Source.asset("./assets/admin.json.zip")
      ],
      destinationBucket: existing_bucket,
      destinationKeyPrefix: "example/",
      prune: false,
});
```
ã¨æ›¸ã‘ã°`prune: false`ã«ã‚ˆã£ã¦æ—¢å­˜ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¯å½±éŸ¿ã‚’ä¸ãˆãšã€app.jsonã¨admin.jsonã‚’åŒæ™‚ã«æ›´æ–°ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã ã‚ã†ã€‚ï¼ˆsourcesãŒé…åˆ—ã«ãªã£ã¦ã„ã‚‹ã®ã«ä½•æ•…ã‹1ã¤ã—ã‹æŒ‡å®šã§ããªã„ã¨éŒ¯è¦šã—ã¦ã„ãŸ...ï¼‰


## ãŠã¾ã‘
ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ä»•çµ„ã¿ã«ã¤ã„ã¦ã€ã¡ã‚‡ã£ã¨ã ã‘æ·±æ˜ã‚Šã€‚
aws_s3_deploymentãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯å†…éƒ¨çš„ã«Lambdaé–¢æ•°ã‚’ä½œã£ã¦ã€Lambdaé–¢æ•°ã®ä¸­ã‹ã‚‰ CLIã®`aws s3 sync`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦S3 ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã‚‹ã€‚Lambdaé–¢æ•°ã®ã‚³ãƒ¼ãƒ‰`index.py`ã¯ä»¥ä¸‹ã«ã‚ã‚‹ã€‚

https://github.com/aws/aws-cdk/blob/main/packages/%40aws-cdk/custom-resource-handlers/lib/aws-s3-deployment/bucket-deployment-handler/index.py

CloudFormation è¦‹ã‚‹ã¨ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®ä¸­ã«Lambdaé–¢æ•°ãŒå«ã¾ã‚Œã¦ã„ã¦ï¼Œå®Ÿéš›ã«ä»¥ä¸‹ã®ã‚ˆã†ãª Lambdaé–¢æ•°ãŒä½œã‚‰ã‚Œã¦ã„ãŸã€‚

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2024-06-02 19.16.37.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3655825/9279c088-e174-1482-fac0-15da9e983720.png)

![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2024-06-02 19.17.58.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/3655825/824118ff-14f5-b156-caf3-740378ca10ad.png)


ã“ã“ã§`aws s3 sync`ã‚’ã—ã¦ã„ãŸã€‚



## æœ€å¾Œã«
ä»Šå›ã¯ã€aws-s3-deploymentãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã—ãŸã€‚
çµå±€ãƒãƒã‚³ãƒ³ã§ã‚„ã‚Œã°ã„ã„ã˜ã‚ƒã‚“ã¨æ€ã†æ–¹ã‚‚ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€CIã§ã‚„ã‚ŠãŸã„å ´åˆã‚„ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§ãƒ¬ãƒ“ãƒ¥ãƒ¼æ–‡åŒ–ã‚’å–ã‚Šå…¥ã‚Œã¦ã‚„ã‚ŠãŸã„å ´åˆã‚‚ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚ãã‚“ãªæ™‚ã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚
ä»–ã«ã‚‚ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚„ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ–¹æ³•ãŒè‰²ã€…ã‚ã‚‹ã®ã§æ°—ã«ãªã‚‹æ–¹ã¯ä»¥ä¸‹ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_s3_deployment-readme.html#supported-sources


